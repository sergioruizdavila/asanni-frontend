{"version":3,"sources":["app/pages/editProfile/editProfile.controller.ts"],"names":[],"mappings":"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","file":"../../../../www/app/pages/editProfile/editProfile.controller.js","sourcesContent":["/**\n * EditProfileController\n * @description - Edit User Profile Page Controller\n */\n\nmodule app.pages.editProfile {\n\n    /**********************************/\n    /*           INTERFACES           */\n    /**********************************/\n    export interface IEditProfileController {\n        activate: () => void;\n    }\n\n    interface IEditProfileError {\n        message: string;\n    }\n\n    /****************************************/\n    /*           CLASS DEFINITION           */\n    /****************************************/\n    export class EditProfileController implements IEditProfileController {\n\n        static controllerId = 'mainApp.pages.editProfile.EditProfileController';\n\n        /**********************************/\n        /*           PROPERTIES           */\n        /**********************************/\n        isTeacher: boolean;\n        teacherData: app.models.teacher.Teacher;\n        progressWidth: string;\n        // --------------------------------\n\n\n        /*-- INJECT DEPENDENCIES --*/\n        public static $inject = [\n            'mainApp.core.util.GetDataStaticJsonService',\n            'mainApp.core.util.FunctionsUtilService',\n            'mainApp.models.user.UserService',\n            'mainApp.models.teacher.TeacherService',\n            'mainApp.core.util.messageUtilService',\n            'dataConfig',\n            '$state',\n            '$stateParams',\n            '$filter',\n            '$scope',\n            '$window',\n            '$rootScope',\n            '$uibModal',\n            'waitForAuth'];\n\n        /**********************************/\n        /*           CONSTRUCTOR          */\n        /**********************************/\n        constructor(\n            private getDataFromJson: app.core.util.getDataStaticJson.IGetDataStaticJsonService,\n            private functionsUtilService: app.core.util.functionsUtil.IFunctionsUtilService,\n            private userService: app.models.user.IUserService,\n            private teacherService: app.models.teacher.ITeacherService,\n            private messageUtil: app.core.util.messageUtil.IMessageUtilService,\n            private dataConfig: IDataConfig,\n            private $state: ng.ui.IStateService,\n            private $stateParams: app.core.interfaces.IStateParamsData,\n            private $filter: angular.IFilterService,\n            private $scope: angular.IScope,\n            private $window,\n            private $rootScope: app.core.interfaces.IMainAppRootScope,\n            private $uibModal: ng.ui.bootstrap.IModalService,\n            waitForAuth) {\n\n            this._init();\n\n        }\n\n        /*-- INITIALIZE METHOD --*/\n        private _init() {\n            //VARIABLES\n            let self = this;\n            let loggedUserId = this.$rootScope.userData.id;\n\n            //Get current state\n            let currentState = this.$state.current.name;\n\n            if(this.$rootScope.profileData) {\n                //Validate if is teacher to change some text on view\n                this.isTeacher = this.$rootScope.profileData.IsTeacher;\n            }\n\n            this.activate();\n        }\n\n        /*-- ACTIVATE METHOD --*/\n        activate(): void {\n            //CONSTANTS\n            const ENTER_MIXPANEL = 'Enter: Edit Profile Page';\n            //VARIABLES\n            let self = this;\n\n            //LOG\n            console.log('editProfile controller actived');\n\n            //MIXPANEL\n            mixpanel.track(ENTER_MIXPANEL);\n\n            //SUBSCRIBE TO EVENTS\n            this._subscribeToEvents();\n\n            //Charge user profile data\n            this.fillFormWithProfileData();\n\n        }\n\n        /**********************************/\n        /*            METHODS             */\n        /**********************************/\n\n\n        /**\n        * fillFormWithProfileData\n        * @description - get user profile data from DB, and fill each field on form.\n        * @function\n        * @return void\n        */\n\n        fillFormWithProfileData(): void {\n            // VARIABLES\n            let self = this;\n            let userId = this.$rootScope.userData.id;\n\n            if(userId) {\n                // GET USER PROFILE DATA\n                this.userService.getUserProfileById(userId)\n                .then(\n                    function(response) {\n\n                        if(response.userId) {\n                            self.$rootScope.profileData = new app.models.user.Profile(response);\n                            self.$scope.$broadcast('Fill User Profile Form', self.$rootScope.profileData);\n                        }\n\n                    }\n                );\n            }\n        }\n\n\n\n        /**\n        * _subscribeToEvents\n        * @description - this method subscribes Create Teacher Page to Child's Events\n        * @use - this._subscribeToEvents();\n        * @function\n        * @return {void}\n        */\n        private _subscribeToEvents(): void {\n            // VARIABLES\n            let self = this;\n\n            /**\n            * Save Profile Data event\n            * @description - Parent (EditProfileController) receive Child's\n                             event in order to save user profile data on BD\n            * @event\n            */\n            this.$scope.$on('Save Profile Data', function(event, args){\n                //CONSTANTS\n                const SUCCESS_MESSAGE = self.$filter('translate')('%notification.success.text');\n                //VARIABLES\n                let userId = self.$rootScope.profileData.UserId;\n                /**************************************************************/\n\n                if(userId) {\n                    self.userService.updateUserProfile(self.$rootScope.profileData)\n                    .then(\n                        function(response) {\n                            if(response.userId) {\n                                //Fill Form\n                                self.$rootScope.profileData = new app.models.user.Profile(response);\n                                //TODO: Validar si esto es necesario ya que estoy guardando todo en $rootScope\n                                // ya deberia poder tener acceso en los hijos\n                                self.$scope.$broadcast('Fill User Profile Form', self.$rootScope.profileData);\n                                self.$scope.$broadcast('Saved');\n                            }\n                        },\n                        function(error) {\n                            self.messageUtil.error('');\n                            self.$scope.$broadcast('Fill User Profile Form', 'error');\n                        }\n                    );\n                }\n            });\n\n        }\n\n    }\n\n\n    /*-- MODULE DEFINITION --*/\n    angular\n        .module('mainApp.pages.editProfile')\n        .controller(EditProfileController.controllerId,\n                    EditProfileController);\n\n}\n"]}